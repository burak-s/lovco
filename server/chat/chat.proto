syntax = "proto3";

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

option go_package = "./chat";

service ChatService {
   rpc JoinChat(JoinChatRequest) returns (stream ChatMessage) {}
   rpc WatchChatQueue(JoinChatRequest) returns (stream QueueResponse) {}
   rpc SendMessage(ChatMessageRequest) returns (google.protobuf.Empty) {}
   rpc EndChatSession(EndChatRequest) returns (google.protobuf.Empty) {}
}

message ChatMessage {
   string id = 1;
   string leftover_id = 2;
   string user_id = 3;
   string message = 4;
   string image = 5;
   google.protobuf.Timestamp created_at = 6;
}

message ChatMessageRequest {
   string leftover_id = 1;
   string user_id = 2;
   string message = 3;
   string image = 4;
}

message EndChatRequest {
   string leftover_id = 1;
   string user_id = 2;
}

message JoinChatRequest {
   string leftover_id = 1;
   string user_id = 2;
}

message QueueResponse {
   int32 queued_count = 1;
   int32 position = 2;
}